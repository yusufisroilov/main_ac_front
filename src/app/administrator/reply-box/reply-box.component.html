<div class="reply-box-container">
    <!-- File Preview Section -->
    <div class="file-preview-section" *ngIf="selectedFiles.length > 0">
        <div class="file-preview-header">
            <span class="file-count">{{ selectedFiles.length }} file(s) selected</span>
            <button mat-icon-button (click)="clearAllFiles()" matTooltip="Remove all files">
                <mat-icon>close</mat-icon>
            </button>
        </div>
        <div class="file-preview-list">
            <div *ngFor="let file of selectedFiles; let i = index" class="file-preview-item">
                <!-- Image Preview -->
                <div *ngIf="isImageFile(file.name)" class="preview-image">
                    <img [src]="file.preview" [alt]="file.name">
                </div>
                <!-- File Icon -->
                <div *ngIf="!isImageFile(file.name)" class="preview-icon">
                    <mat-icon>{{ getFileIcon(file.name) }}</mat-icon>
                </div>
                <!-- File Info -->
                <div class="preview-info">
                    <span class="preview-name">{{ file.name }}</span>
                    <span class="preview-size">{{ formatFileSize(file.size) }}</span>
                </div>
                <!-- Remove Button -->
                <button mat-icon-button (click)="removeFile(i)" class="preview-remove">
                    <mat-icon>close</mat-icon>
                </button>
            </div>
        </div>
    </div>

    <!-- Message Input Section -->
    <div class="message-input-section">
        <textarea #messageInput [(ngModel)]="messageText" [placeholder]="placeholder" class="message-textarea" rows="3"
            [disabled]="isSubmitting" (keydown)="onKeyDown($event)"></textarea>

        <!-- Actions Row -->
        <div class="actions-row">
            <!-- File Upload Button -->
            <div class="file-upload-wrapper">
                <input type="file" #fileInput (change)="onFileSelect($event)" multiple accept="image/*,.pdf,.zip,.rar"
                    style="display: none;">
                <button mat-icon-button (click)="fileInput.click()" [disabled]="selectedFiles.length >= maxFiles"
                    matTooltip="Attach files (Max {{ maxFiles }})">
                    <mat-icon>attach_file</mat-icon>
                </button>
                <span class="file-limit-text">{{ selectedFiles.length }}/{{ maxFiles }}</span>
            </div>

            <!-- Character Count -->
            <span class="char-count" [ngClass]="{'text-warning': messageText.length > 900}">
                {{ messageText.length }} / 1000
            </span>

            <!-- Submit Button -->
            <button mat-raised-button color="primary" (click)="onSubmit()" [disabled]="!isValid() || isSubmitting"
                class="submit-button">
                <mat-spinner *ngIf="isSubmitting" diameter="20" class="spinner-inline"></mat-spinner>
                <mat-icon *ngIf="!isSubmitting">send</mat-icon>
                <span *ngIf="!isSubmitting">{{ submitButtonText }}</span>
            </button>
        </div>

        <!-- Hint Text -->
        <div class="hint-text">
            <mat-icon class="hint-icon">info</mat-icon>
            <span>{{ hintText }}</span>
        </div>
    </div>
</div>